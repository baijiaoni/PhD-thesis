The FAIR project is aiming at providing high-energy beams of ions of all elements from hydrogen to uranium, as well as antiprotons and rare isotopes with high intensities. The existing accelerator facility of GSI and the future FAIR facility employ a variety of circular accelerators like heavy ion synchrotrons (the SIS18 and the SIS100) and storage rings (the ESR, the CRYRING, the CR and the HESR) for the preparation of secondary beams and experiments. Bunches are required to be transferred into rf buckets among GSI and FAIR ring accelerators for different purposes. Without the proper transfer, the beam will be subject to various beam quality (emittance) deterioration and even to beam losses. Hence, the proper bunch-to-bucket transfer between two rings is of great importance for FAIR and is the topic, which has been investigated in this thesis. Although an implementation of the B2B transfer from the SIS18 to the ESR exists, this solution is not applicable for the new FAIR accelerator complex, because it is realized based on the GSI control system, an event based system. It will be replaced by a new control system for FAIR. The FAIR control system is based on the sub-nanosecond synchronization White Rabbit network. Besides, the existing GSI control system doesn't support the B2B transfer with the phase shift method and with the complex bucket patterns. Hence, a new FAIR B2B transfer system is required, which relies on the FAIR technical basis, the FAIR timing and control system and the low-level radio frequency (LLRF) system.

%The conceptual realization of the FAIR B2B transfer system is introduced in the dissertation. For the B2B transfer, there is a “B2B transfer master“, which is responsible for the data collection of two ring accelerators, the data calculation, the data redistribution and the B2B transfer status check. Synchronization reference signals are synchronously distributed around the FAIR campus. In the dissertation, the source ring works as the “B2B transfer master“. The phase deviation between the rf system and the synchronization reference signal is measured and extrapolated at both rings. The extrapolated phase of the target ring must be transferred to the “B2B transfer master“ via the deterministic WR network in the format of the timing frame. The phase difference between the two rf systems of the rings is obtained by the subtraction of two extrapolated phases. The source ring is responsible for the calculation of the start of the synchronization window, the phase correction and the required phase shift (only for phase shift method). The synchronization window is used to select the first occurrence of the bucket indication signal marker. The extraction and injection kickers are triggered based on the selected bucket indication signal marker plus a specified delay. 

% Additionally, all FAIR use cases are analyzed and the precision of the B2B transfer is calculated for all use cases. 


The conceptual realization of the FAIR B2B transfer system was introduced in this thesis for the first time. The development of the concept of the system involves mainly the timing and LLRF perspectives. The contribution to the development of the system from the timing perspective is presented in the dissertation at hand. In addition, my dedication extends to the development of the technical concept of the FAIR B2B transfer system, which has been worked out for the FAIR project. In summary the following technical specifications can be achieved by the FAIR B2B transfer system. 
\begin{itemize}
	\item The system achieves the most FAIR B2B transfers with a tolerable bunch-to-bucket injection center mismatch (e.g. $\pm 1^\circ$) and within an upper bound time (e.g. \SI{10}{\ms}). 
	\item It supports both the phase shift and frequency beating methods. 
	\item It is flexible to support the beam transfer between two rings with different ratios in their circumference and several B2B transfers running at the same time, e.g. the B2B transfer from the SIS18 to the SIS100 and at the same time the B2B transfer from the ESR to the CRYRING. 
	\item It is capable to transfer beam of different ion species from one machine cycle to another.
	\item It supports the beam transfer via the FRS, the pbar target and the Super-FRS. 
	\item It allows various complex bucket filling patterns. 
	\item In addition, it coordinates with the MPS system, which protects the SIS100 and subsequent accelerators or experiments from beam induced damage. 
\end{itemize}

A list of criteria for the preservation of beam qualities during the rf frequency modulation of the phase shift method was analyzed. Beam reactions on three different rf frequency modulation examples were analyzed for SIS18 beams. According to the beam dynamic analysis, there is a maximum value for the rf frequency modulation, which comes from the constraint of the momentum shift. The first time derivative of the rf frequency modulation must be continuous and small enough to guarantee the size of the running bucket. The second time derivative must be small enough to guarantee the change of the synchronous phase slow enough for the beam to follow, which is reflected by the parameter of the adiabaticity. In order to guarantee a bucket area factor larger than $80\%$ and an adiabaticity smaller than $10^{-4}$, for the SIS18 \SI{200}{MeV/u} $U^{28+}$ beam, $|\Delta f_{\mathit{rf}}|$ must be smaller than \SI{8.137}{kHz} and $|\frac{d\Delta f_{\mathit{rf}}}{dt}|$ must be continuous and smaller than \SI{95}{Hz/ms} and $|\frac{d^2\Delta f_{\mathit{rf}}}{dt^2}|$ must be smaller than \SI{70}{Hz/ms^2}. For the SIS18 \SI{4}{GeV/u} $H^{+}$ beam, $|\Delta f_{\mathit{rf}}|$ must be smaller than \SI{283}{Hz} and $|\frac{d\Delta f_{\mathit{rf}}}{dt}|$ must be continuous and smaller than \SI{1.9}{Hz/ms} and $|\frac{d^2\Delta f_{\mathit{rf}}}{dt^2}|$ must be smaller than \SI{0.2}{Hz/ms^2}.  In regard with these requirements, the sinusoidal and parabolic rf frequency modulation profiles with a certain duration were checked for the SIS18 $U^{28+}$ beam. Both two modulation profiles meet the requirements and keep the beam stable. However, compared with the parabolic modulation, the sinusoidal modulation has the smaller adiabaticity. Hence, the sinusoidal modulation is preferable for the phase shift method. The sinusoidal rf frequency modulation for the SIS18 \SI{200}{MeV/u} $U^{28+}$ needs \SI{7}{\ms} and the sinusoidal rf frequency modulation for the SIS18 \SI{4}{GeV/u} $H^{+}$ needs approximately \SI{50}{\ms} for the phase shift of $\pi$. 

In addition to the analysis from the viewpoint of beam dynamics, two test setups were built. The first test setup was used to characterize the WR network for the B2B transfer. According to the test result, the tolerable number of WR switch layers for the B2B transfer depends not only on the upper bound transfer latency (e.g. \SI{400}{\us}), but also the tolerable frame error rate of the B2B transfer system. If no forward error correction mechanism is used for the B2B transfer, the number of WR switch layers is mainly decided by the tolerable frame error rate. If for instance one lost frame is tolerable every two month, the maximum 38 WR switches can be used between the B2B related SCUs and the DM and the maximum 8 WR switches can be used between the B2B related SCUs. If specific forward error correction mechanisms are used, the number of WR switch layers depends mainly on the tolerable transfer latency. In this case, the tolerable number of WR switches is 67 between the B2B related SCUs and the DM and the tolerable number of WR switches is 13 between the B2B related SCUs. In the second test setup, the firmware of the FAIR B2B transfer system was evaluated, which was running on the soft CPU, LatticeMico32, of the SCUs. The running time of tasks of the firmware was measured. It has proven that the firmware running on the LatticeMico32 of the SCUs meets the requirement of the timing constraints, when the related System-on-Chip bus is not occupied by any other applications at the same time as the firmware is running.

%\begin{table}[!htb]
%\newcommand{\tabincell}[2]{\begin{tabular}{@{}#1@{}}#2\end{tabular}}
%\caption{The tolerable number of WR switch layers for the B2B related traffic}
%\label{tolerable_num}
%\begin{center}
%    \begin{tabular}{ | c |c | c | c | c | c | c | c |}
%    \hline
%                   & \multicolumn{2}{|c|}{Requirement from FER} & \multicolumn{2}{|c|}{Requirement from latency} \\ \hline
%    one lost frame	& B2B Unicast & B2B Broadcast & B2B Unicast & B2B Broadcast \\ \hline
%	 per month		&  \cellcolor{gray}76		&  \cellcolor{gray}15            & 67          & 13            \\ \hline 
%	  \multicolumn{5}{|c|}{No forward error correction mechanism is implemented}  \\ \hline 
%	 every 2 months	& 38	 & 8   & \cellcolor{gray}67 & \cellcolor{gray}13            \\ \hline 
%	 every 4 months	& 19 	 & 4   & \cellcolor{gray}67 & \cellcolor{gray}13            \\ \hline 
%	 every 8 months	& 9 	 & 2   & \cellcolor{gray}67 & \cellcolor{gray}13            \\ \hline 
%	 every 18 months& 4 	 & 1   & \cellcolor{gray}67 & \cellcolor{gray}13            \\ \hline 
%	  \multicolumn{5}{|c|}{Forward error correction mechanisms are implemented}  \\ \hline 
%	 every 8 months	& \cellcolor{gray}9 	 & \cellcolor{gray}2   & 67 & 13            \\ \hline 
%	 every 18 months& \cellcolor{gray}4 	 & \cellcolor{gray}1   & 67 & 13            \\ \hline 
%\multicolumn{5}{|@{}l|}{ \tabincell{c}{\\ * Values in the gray table cells are not applicable.}} \\ \hline
%    \end{tabular}
%\end{center}
%\end{table}

Furthermore, the propagation of the measurement uncertainties (e.g. the $0.1^\circ$ phase measurement uncertainty, the \SI{100}{ps} BuTiS C2 clock uncertainty and the \SI{1}{ns} timestamp measurement uncertainty) to the time point of the phase alignment was checked for all FAIR use cases in this thesis. The bunch-to-bucket injection center mismatch is deteriorated by the time uncertainty of the phase alignment in various degrees. For some use cases the bunch-to-bucket injection center mismatch is seriously deteriorated. e.g. the mismatch is deteriorated by $37\%$ for the $U^\mathit{28+}$ B2B transfer from the SIS18 to the SIS100. However, the deteriorated mismatch still meets the requirement smaller than $\pm1^\circ$. Hence, the measurement uncertainties are acceptable for the FAIR B2B transfer system. In addition, the requirement of the accuracy of the start of the synchronization window for all FAIR use cases was also checked in this thesis. The most stringent requirement of the accuracy comes from the h=1 B2B transfer from the SIS18 to the ESR, which is approximately \SI{500}{\ns}. 

Besides, the boundary conditions of the different trigger scenarios of the SIS18 extraction and SIS100 injection kicker magnets were investigated. The nine SIS18 extraction kicker magnets are distributed into two tanks. For the SIS18 and SIS100 kickers, there are the following technical constraints.
\begin{itemize}
	\item The SIS18 kicker magnets in each tank can be triggered simultaneously when the bunch gap is at least $25\%$ of the cavity rf period. 
	\item The four SIS18 kicker magnets in the $2^{nd}$ tank can be triggered a fixed delay to the trigger of the five SIS18 kicker magnets in the $1^{st}$ tank for all ion beams, when the bunch gap is at least $25\%$ of the cavity rf period. 
	\item The six SIS100 injection kicker magnets are evenly distributed in one tank. They can be fired instantaneously for all ion beams, when the bunch gap is at least $35\%$ of the cavity rf period.
\end{itemize}

Finally, the application of the FAIR B2B transfer system with the frequency beating method for all FAIR use cases was demonstrated, see Tab. ~\ref{use_application}. It has been shown that for all primary beam transfers of FAIR use cases, the B2B transfer with the bunch-to-bucket injection center mismatch less than $\pm1^\circ$ and within the required B2B transfer time \SI{10}{\ms} can be achieved, because the circumference ratio between two rings is an integer or close to an integer. However, the system is also required for the FAIR use cases that the secondary beams are generated by the pbar target, the FRS or the Super-FRS with an arbitrary energy ratio between the primary and secondary beams. For the rare isotope beam (RIB) transfer from the SIS100 to the CR via the Super-FRS with the \SI{1.5}{GeV/u} primary beam energy and the \SI{740}{MeV/u} secondary beam energy, the bunch-to-bucket injection center mismatch is only $\pm2.1^\circ$ by coincidence. For the antiproton B2B transfer from the SIS100 to the CR via the pbar target and the RIB transfer form the SIS18 to the ESR via the FRS, the bunch-to-bucket injection center mismatch is as large as $\pm40^\circ$, which is far beyond the upper bound injection center mismatch.


\begin{table}[!htb]
\newcommand{\tabincell}[2]{\begin{tabular}{@{}#1@{}}#2\end{tabular}}
\caption{Application of the FAIR B2B transfer system for FAIR accelerators}
\label{use_application}
\begin{center}

    \begin{tabular}{ | c | p{4cm}|  p{2cm} |p{6cm} |}
    \hline
%\rowcolor[gray]{0.5}
     	No. & \multicolumn{1}{|c|}{FAIR use cases} & B2B injection center mismatch & \multicolumn{1}{|c|}{Remark} \\ \hline
1&	$U^{28+}$ B2B transfer from SIS18 to SIS100	&	$\pm0.4^\circ$ 	& \multirow{5}{*}{\parbox{6cm}{The FAIR use cases 1-5 have the B2B injection center mismatch smaller than the upper bound $\pm1^\circ$, because the circumference ratio between two rings is an integer or close to an integer.}}\\ \cline{1-2}
2&$H^{+}$ B2B transfer from SIS18 to SIS100	&	$\pm0.4^\circ$	&	\\ \cline{1-3}
3&h=4 B2B transfer from SIS18 to ESR				&	$\pm0.5^\circ$	&	\\ \cline{1-3}
4&h=1 B2B transfer from SIS18 to ESR				&	$\pm0.5^\circ$	&  \\ \cline{1-3}
5&B2B transfer from ESR to CRYRING				&	$\pm0.5^\circ$	&	\\ \hline
6&B2B transfer from CR to HESR	&$\pm1.2^\circ$ & The B2B injection center mismatch is just beyond the specification, but it is still acceptable. Although the circumference ratio between two rings is far away from an integer.\\ \hline

7&$H^{+}$ B2B transfer from SIS100 to CR via the pbar target			&$\pm41.5^\circ$& \multirow{5}{*}{\parbox{6cm}{The B2B injection center mismatch is far beyond the specification, because the energy ratio before and after targets is arbitrary. (The FAIR use case No. 8 is close to the specification and still acceptable by coincidence.)}}\\ \cline{1-3}
8&RIB B2B transfer from SIS100 to CR via the Super-FRS					&	$\pm2.1^\circ$	& \\ \cline{1-3}

9&RIB B2B transfer from SIS18 to ESR via the FRS	&$\pm31.2^\circ$	&		\\ \hline

    \end{tabular}
\end{center}
\end{table}
%This work presents a test setup for the system, achieving the phase collection of two ring accelerators locally, the phase transfer from the target synchrotron to the source synchrotron, the calculation of the synchronization window at the source synchrotron, the redistribution of the start of the synchronization window to the WR network and the reproduction of the synchronization window at the source/target synchrotron. 

The dissertation at hand comprises the important investigations for the FAIR B2B transfer system from the beam dynamics, timing and kicker trigger perspectives. However, there are still some investigations which are required for the final system operation:
\begin{itemize}
	\item The synchronization between the magnetic horn after the pbar target and the antiproton beam to the \SI{}{\us} order of magnitude.

	\item  The synchronization between the bunch compressor of the SIS100 and the beam extraction.

	\item  
For several FAIR use cases of the secondary beam, the bunch-to-bucket injection center mismatch is larger than $\pm30^\circ$. For these FAIR use cases, it is necessary to check whether the FAIR B2B transfer system can work together with specific beam accumulation methods, e.g. the barrier bucket or the unstable fixed point accumulation.


\end{itemize}


The FAIR B2B transfer system presented in the dissertation is applicable for all FAIR use cases. However, there is still potential for improvement. For the phase shift method, the rf frequency modulation must be slow enough (e.g. the \SI{7}{\ms}/\SI{50}{\ms} sinusoidal modulation for the SIS18 $U^\mathit{28+}$/$H^\mathit{+}$ beam). In order to transfer bunches into buckets as soon as possible, the phase shift can be started during the acceleration ramp. At a certain time point during the acceleration, the phases difference between the two rf systems of the source and target rings is obtained with the help of the synchronization reference signal. There is a look-up table, which gives the phase difference at the rf flattop according to the phase difference obtained at the certain time point. Then, an rf frequency modulation is superposed on the initial frequency pattern of one (or both) rings. With this new frequency pattern, the phase difference will be the required phase difference when the cavity rf frequency of the source ring reaches the rf flattop. 

